<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Faculty Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <nav>
      <ul class="nav-bar">
        <li class="logo"><a href="index.html">EDGo Logo</a></li>
        <div class="center-links">
          <h1 class="glow-title">Faculty Dashboard</h1>
        </div>
      </ul>
      <a href="index.html" class="home" title="Home"></a>
      <a href="personalInfo.html" class="profile-icon" title="Profile"></a>
    </nav>
  </header>

  <section class="features">
    <section class="performance-data">
      <div class="summary-cards">
        <div class="card">
          <h4>Average Midterm Score</h4>
          <p><span class="highlight" id="average-score">Loading...</span></p>
        </div>
        <div class="card">
          <h4>Total Retakes Remaining</h4>
          <p><span class="highlight">9</span></p>
        </div>
      </div>

      <table class="performance-table">
        <thead>
          <tr>
            <th>Student ID</th>
            <th>Name</th>
            <th>Midterm Score</th>
            <th>Current Level</th>
            <th>Retake Date</th>
          </tr>
        </thead>
        <tbody>
          <!-- Dynamic rows will be inserted here from Firebase -->
        </tbody>
      </table>
    </section>

    <button id="toggle-sidebar" class="sidebar-toggle"></button>

    <div id="sidebar" class="sidebar">
      <ul>
        <li><a href="#">Student Performance</a></li>
        <li><a href="#">Retake Request</a></li>
        <li><a href="addStudent.html">Add Student</a></li>
        <li><a href="grading.html">Feedback and Messaging</a></li>
        <li><a href="#">AI Assesment</a></li>
        <li><a href="#">Settings</a></li>
      </ul>
    </div>
  </section>

  <section class="lower">
    <h2>Explore More Features</h2>
    <p>Our AI assistant helps with quizzes and grading!</p>
  </section>

  <footer>
    Dhaka, Bangladesh
  </footer>
  <!-- Logout Button -->
<button id="logout-button" class="logout-button">Logout</button>
  <button class="learn-more">Click here to learn more</button>

  <!-- Use "type=module" to use ES modules (import/export) -->
  <script type="module">
    // Import necessary Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD63qm0V0F0Y0PExzmmOCP9nJ7a6x1vCgs",
      authDomain: "edora2.firebaseapp.com",
      projectId: "edora2",
      storageBucket: "edora2.firebasestorage.app",
      messagingSenderId: "908106047332",
      appId: "1:908106047332:web:4b412cd208e88fceb06471",
      measurementId: "G-ELBKQDSSKC",
      databaseURL: "https://edora2-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();

    // Fetch student data from Firebase Realtime Database
    window.onload = function() {
      onAuthStateChanged(auth, function(user) {
        if (user) {
          const teacherId = user.uid; // Get the teacher's UID
          
          const studentsRef = ref(database, `teachers/${teacherId}/students`);
          get(studentsRef)
            .then((snapshot) => {
              if (snapshot.exists()) {
                const students = snapshot.val();
                const tableBody = document.querySelector('.performance-table tbody');
                const averageScoreElement = document.getElementById('average-score');
                
                let totalScore = 0;
                let studentCount = 0;

                tableBody.innerHTML = ''; // Clear previous rows

                for (const studentId in students) {
                  const student = students[studentId];

                  totalScore += student.midtermScore;
                  studentCount++;

                  const tr = document.createElement('tr');
                  tr.innerHTML = `
                    <td>${studentId}</td>
                    <td>${student.name}</td>
                    <td>${student.midtermScore} / ${student.totalScore}</td>
                    <td>Completed ${student.completedLevels.filter(level => level === true).length} out of 3 Levels</td>
                    <td>${new Date(student.retakeDate).toLocaleString()}</td>
                  `;
                  tableBody.appendChild(tr);
                }

                // Calculate and display the average score
                if (studentCount > 0) {
                  const averageScore = totalScore / studentCount;
                  averageScoreElement.textContent = averageScore.toFixed(2);
                } else {
                  averageScoreElement.textContent = 'No students available';
                }

              } else {
                console.log("No data available");
                document.getElementById('average-score').textContent = 'No data available';
              }
            })
            .catch((error) => {
              console.error("Error fetching data from Firebase:", error);
              document.getElementById('average-score').textContent = 'Error fetching data';
            });
        } else {
          // If no user is logged in, redirect to login
          window.location.href = 'login.html';
        }
      });
    };
  </script>

  <script>
    // Toggle sidebar visibility
    document.getElementById('toggle-sidebar').addEventListener('click', () => {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('active'); // Toggle the "active" class
    });

    // Logout functionality
  const logoutButton = document.getElementById("logout-button");
  logoutButton.addEventListener("click", () => {
    signOut(auth)
      .then(() => {
        window.location.href = "index.html"; // Redirect to login page after logout
      })
      .catch((error) => {
        console.error("Error signing out: ", error);
      });
  });
  </script>

  

</body>
</html>
